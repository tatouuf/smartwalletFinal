<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<StackPane xmlns:fx="http://javafx.com/fxml"
           fx:controller="esprit.tn.souha_pi.controllers.loan.RequestLoanController"
           style="-fx-background-color: #f5f7fb; -fx-padding: 30;">

    <VBox alignment="CENTER" spacing="25">

        <!-- Carte principale -->
        <VBox spacing="20" maxWidth="500" style="-fx-background-color: white; -fx-background-radius: 25; -fx-padding: 30; -fx-effect: dropshadow(two-pass-box, rgba(0,0,0,0.1), 20, 0, 0, 5); -fx-border-color: #e5e7eb; -fx-border-width: 1; -fx-border-radius: 25;">

            <Label text="Request a Loan" style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #4f46e5;"/>

            <Separator style="-fx-background-color: #e5e7eb; -fx-padding: 5 0;"/>

            <!-- SÃ©lection du prÃªteur -->
            <VBox spacing="8">
                <Label text="Choose a lender" style="-fx-font-weight: 600; -fx-text-fill: #374151;"/>
                <ComboBox fx:id="userCombo" prefHeight="45" promptText="Select a user"
                          style="-fx-background-color: white; -fx-border-color: #d1d5db; -fx-border-radius: 10; -fx-background-radius: 10; -fx-padding: 5;"/>
            </VBox>

            <!-- Montant -->
            <VBox spacing="8">
                <Label text="Amount (TND)" style="-fx-font-weight: 600; -fx-text-fill: #374151;"/>
                <TextField fx:id="amountField" promptText="Ex: 150"
                           style="-fx-background-color: white; -fx-border-color: #d1d5db; -fx-border-radius: 10; -fx-background-radius: 10; -fx-padding: 12 15;"/>
            </VBox>

            <!-- Message -->
            <VBox spacing="8">
                <Label text="Message (optional)" style="-fx-font-weight: 600; -fx-text-fill: #374151;"/>
                <TextArea fx:id="messageField" prefHeight="100" promptText="Explain why you need the loan..."
                          style="-fx-background-color: white; -fx-border-color: #d1d5db; -fx-border-radius: 10; -fx-background-radius: 10; -fx-padding: 10;"/>
            </VBox>

            <!-- Analyse IA -->
            <VBox fx:id="iaAnalysisBox" spacing="12"
                  style="-fx-background-color: #f0f9ff; -fx-padding: 20; -fx-background-radius: 15; -fx-border-color: #bae6fd; -fx-border-radius: 15;"
                  visible="false" managed="false">

                <Label text="ðŸ¤– ANALYSE IA" style="-fx-font-weight: bold; -fx-text-fill: #0369a1; -fx-font-size: 15px;"/>

                <HBox spacing="15" alignment="CENTER_LEFT">
                    <Label fx:id="iaProbabilityLabel" text="ProbabilitÃ©: -" style="-fx-font-weight: bold; -fx-text-fill: #0c4a6e;"/>
                    <ProgressBar fx:id="iaProbabilityBar" prefWidth="200" progress="0"
                                 style="-fx-accent: #7c3aed;"/>
                </HBox>

                <Label fx:id="iaRecommendationLabel" text="Niveau: -" style="-fx-text-fill: #0369a1;"/>
                <Label fx:id="iaSuggestionLabel" text="ðŸ’¡ " wrapText="true" style="-fx-text-fill: #0c4a6e;"/>

                <CheckBox fx:id="iaOptimizeCheckbox" text="Optimiser avec IA"
                          style="-fx-text-fill: #0369a1; -fx-font-weight: 600;"/>
            </VBox>

            <!-- Bouton d'envoi -->
            <Button text="ðŸ¤ Send Loan Request" prefHeight="50" onAction="#sendRequest"
                    style="-fx-background-color: #7c3aed; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 25; -fx-cursor: hand; -fx-font-size: 16px; -fx-effect: dropshadow(two-pass-box, rgba(124,58,237,0.3), 10, 0, 0, 3);"/>

            <Label fx:id="statusLabel" style="-fx-text-fill: #10b981; -fx-font-size: 14px;" textAlignment="CENTER"/>

        </VBox>

        <!-- Conteneur IA Insights -->
        <VBox fx:id="iaInsightsContainer" spacing="12" maxWidth="500"
              style="-fx-background-color: #f3e8ff; -fx-padding: 20; -fx-background-radius: 20; -fx-border-color: #d8b4fe; -fx-border-radius: 20; -fx-effect: dropshadow(two-pass-box, rgba(0,0,0,0.05), 10, 0, 0, 3);">

            <Label text="ðŸ“Š STATISTIQUES IA" style="-fx-font-weight: bold; -fx-text-fill: #6b21a5; -fx-font-size: 16px;"/>
            <Label fx:id="iaSummaryLabel" text="Analyse globale en cours..." style="-fx-text-fill: #581c87; -fx-wrap-text: true;"/>

        </VBox>

    </VBox>

</StackPane>