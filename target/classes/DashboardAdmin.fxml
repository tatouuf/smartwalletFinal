<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.shape.Circle?>

<StackPane stylesheets="@css/DashboardAdmin.css" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Controllers.DashboardAdminController" styleClass="page-bg">
    <BorderPane prefHeight="700">
        <!-- HEADER SIMPLE -->
        <top>
            <HBox styleClass="header-bar" alignment="CENTER_LEFT" spacing="20">
                <padding>
                    <Insets top="15" right="25" bottom="15" left="25"/>
                </padding>

                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label text="âš¡" styleClass="header-logo"/>
                    <Label text="SmartWallet Admin" styleClass="header-title"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <HBox spacing="15" alignment="CENTER">
                    <Label fx:id="lblAdminName" styleClass="header-admin-name"/>
                    <Button fx:id="btnLogout" onAction="#logout" styleClass="logout-btn" text="ðŸšª DÃ©connexion"/>
                </HBox>
            </HBox>
        </top>

        <!-- CENTER -->
        <center>
            <ScrollPane fitToWidth="true" fitToHeight="true" style="-fx-background-color: transparent; -fx-background: transparent;">
                <VBox spacing="20" minHeight="800" prefHeight="800">
                    <padding>
                        <Insets bottom="20" left="20" right="20" top="10"/>
                    </padding>

                    <!-- Charts - Un seul graphique -->
                    <GridPane hgap="20" vgap="20" minHeight="300">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="100" hgrow="ALWAYS"/>
                        </columnConstraints>
                        <rowConstraints>
                            <RowConstraints minHeight="250" vgrow="ALWAYS"/>
                        </rowConstraints>

                        <!-- Graphique des rÃ©clamations (pleine largeur) -->
                        <VBox spacing="5" styleClass="chart-box" VBox.vgrow="ALWAYS" minHeight="250">
                            <Label styleClass="section-title" text="ðŸ“Š Reclamations Status"/>
                            <PieChart fx:id="pieReclamations" legendVisible="true" labelsVisible="true" VBox.vgrow="ALWAYS" prefHeight="200"/>
                        </VBox>
                    </GridPane>

                    <VBox spacing="5" styleClass="chart-box" VBox.vgrow="ALWAYS" minHeight="250">
                        <Label styleClass="section-title" text="ðŸ“ˆ Users Growth Over Time"/>
                        <LineChart fx:id="lineUsers" prefHeight="250" VBox.vgrow="ALWAYS">
                            <xAxis><CategoryAxis label="Month"/></xAxis>
                            <yAxis><NumberAxis label="Users"/></yAxis>
                        </LineChart>
                    </VBox>

                    <Separator/>

                    <!-- TabPane - SANS COLONNES DÃ‰FINIES -->
                    <TabPane styleClass="modern-tab" tabClosingPolicy="UNAVAILABLE" prefHeight="400" minHeight="400" VBox.vgrow="ALWAYS">

                        <!-- Account Requests -->
                        <Tab text="ðŸ“ Account Requests" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <Label text="Users awaiting account validation" style="-fx-font-weight: bold; -fx-text-fill: #f59e0b; -fx-font-size: 14px;"/>
                                <TableView fx:id="tableAccountRequests" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Wallet Requests -->
                        <Tab text="ðŸ’° Wallet Requests" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <Label text="Approved users awaiting wallet creation" style="-fx-font-weight: bold; -fx-text-fill: #3b82f6; -fx-font-size: 14px;"/>
                                <TableView fx:id="tableWalletRequests" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Users -->
                        <Tab text="ðŸ‘¥ Users" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <TextField fx:id="searchUserField" promptText="Search by name, email or phone..." styleClass="input" prefWidth="350" HBox.hgrow="ALWAYS"/>
                                    <Button text="ðŸ” Search" styleClass="primary-btn" onAction="#handleSearchUsers" prefWidth="100"/>
                                </HBox>
                                <TableView fx:id="tableUsers" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Wallets -->
                        <Tab text="ðŸ’° Wallets" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <TableView fx:id="tableWallets" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Transactions -->
                        <Tab text="ðŸ“Š Transactions" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <TextField fx:id="searchTransactionField" promptText="Search by ID, user ID, type..." styleClass="input" prefWidth="350" HBox.hgrow="ALWAYS"/>
                                    <Button text="ðŸ” Search" styleClass="primary-btn" onAction="#handleSearchTransactions" prefWidth="100"/>
                                </HBox>
                                <TableView fx:id="tableTransactions" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Reclamations -->
                        <Tab text="ðŸ“© Reclamations" closable="false">
                            <VBox spacing="15" alignment="CENTER">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <Button text="Manage Reclamations" styleClass="primary-btn" onAction="#handleManageReclamations" prefWidth="250" prefHeight="45"/>
                                <Label text="Reclamations are shown in the chart above" style="-fx-text-fill: #666666; -fx-font-style: italic;"/>
                            </VBox>
                        </Tab>

                        <!-- Services -->
                        <Tab text="ðŸ› ï¸ Services" closable="false">
                            <VBox alignment="TOP_CENTER" spacing="20">
                                <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                                <ImageView fx:id="imgServiceLogo" fitWidth="120" fitHeight="120" preserveRatio="true">
                                    <clip><Circle radius="60" centerX="60" centerY="60"/></clip>
                                </ImageView>
                                <Label text="Services Management" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #7C4DFF;"/>
                                <HBox alignment="CENTER" spacing="30" VBox.vgrow="ALWAYS">
                                    <VBox spacing="15" alignment="CENTER" styleClass="dashboard-card" prefWidth="220" prefHeight="200">
                                        <ImageView fx:id="imgService" fitHeight="80" fitWidth="80" preserveRatio="true"/>
                                        <Label text="Services" style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                                        <Button onAction="#showAfficherService" text="View Services" styleClass="btn-gradient" prefWidth="150"/>
                                    </VBox>
                                    <VBox spacing="15" alignment="CENTER" styleClass="dashboard-card" prefWidth="220" prefHeight="200">
                                        <ImageView fx:id="imgServiceAdd" fitHeight="80" fitWidth="80" preserveRatio="true"/>
                                        <Label text="Add Service" style="-fx-font-weight: bold; -fx-font-size: 16px;"/>
                                        <Button onAction="#showAjouterService" text="Add New" styleClass="success-btn" prefWidth="150"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </Tab>

                        <!-- Assurances -->
                        <Tab text="ðŸ”’ Assurances" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <HBox alignment="CENTER_LEFT" spacing="20">
                                    <ImageView fx:id="imgLogoAssurance" fitHeight="60" fitWidth="60" preserveRatio="true"/>
                                    <Label text="Insurance Management" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #7C4DFF;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="âž• Add Insurance" onAction="#haamdiah" styleClass="success-btn" prefWidth="150"/>
                                </HBox>
                                <HBox spacing="20" alignment="CENTER">
                                    <Button text="View Insurances" onAction="#showAfficherAssurance" styleClass="primary-btn" prefWidth="200"/>
                                    <Button text="Manage" onAction="#showGestionAssurance" styleClass="btn-secondary" prefWidth="150"/>
                                </HBox>
                                <ScrollPane hbarPolicy="NEVER" VBox.vgrow="ALWAYS" prefHeight="300" style="-fx-background-color: transparent; -fx-border-color: #7C4DFF; -fx-border-width: 2; -fx-border-radius: 10;">
                                    <content>
                                        <FlowPane fx:id="cardAffAssurance" alignment="TOP_LEFT" hgap="15" vgap="15" prefWrapLength="800"/>
                                    </content>
                                </ScrollPane>
                            </VBox>
                        </Tab>

                        <!-- CrÃ©dits -->
                        <Tab text="ðŸ’° CrÃ©dits" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <HBox alignment="CENTER_LEFT" spacing="20">
                                    <ImageView fx:id="imgLogoCredit" fitHeight="60" fitWidth="60" preserveRatio="true"/>
                                    <Label text="Credit Management" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #7C4DFF;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="âž• Add Credit" onAction="#itafaaction" styleClass="success-btn" prefWidth="150"/>
                                </HBox>
                                <HBox spacing="20" alignment="CENTER">
                                    <Button text="View Credits" onAction="#showAfficherCredit" styleClass="primary-btn" prefWidth="200"/>
                                    <Button text="Manage" onAction="#showGestionCredit" styleClass="btn-secondary" prefWidth="150"/>
                                </HBox>
                                <TableView fx:id="tableCredits" styleClass="modern-table" VBox.vgrow="ALWAYS" prefHeight="300"/>
                            </VBox>
                        </Tab>

                        <!-- Statistics -->
                        <Tab text="ðŸ“ˆ Statistics" closable="false">
                            <VBox spacing="15">
                                <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                                <GridPane hgap="20" vgap="20">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="50"/>
                                        <ColumnConstraints percentWidth="50"/>
                                    </columnConstraints>
                                    <VBox styleClass="stat-card" spacing="15" alignment="CENTER_LEFT" prefWidth="400" prefHeight="250" GridPane.rowIndex="0" GridPane.columnIndex="0">
                                        <Label text="System Summary" style="-fx-font-weight: bold; -fx-font-size: 18px; -fx-text-fill: #7C4DFF;"/>
                                        <GridPane hgap="20" vgap="10">
                                            <Label text="Total Users:" GridPane.rowIndex="0" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="lblTotalUsers" text="0" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                                            <Label text="Administrators:" GridPane.rowIndex="1" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="totalAdminsStatLabel" text="0" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                                            <Label text="Regular Users:" GridPane.rowIndex="2" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="totalUsersStatLabel2" text="0" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                                            <Label text="Pending Approvals:" GridPane.rowIndex="3" GridPane.columnIndex="0" style="-fx-font-weight: bold; -fx-text-fill: #f59e0b;"/>
                                            <Label fx:id="totalPendingLabel" text="0" GridPane.rowIndex="3" GridPane.columnIndex="1" style="-fx-text-fill: #f59e0b;"/>
                                        </GridPane>
                                    </VBox>
                                    <VBox styleClass="stat-card" spacing="15" alignment="CENTER_LEFT" prefWidth="400" prefHeight="250" GridPane.rowIndex="0" GridPane.columnIndex="1">
                                        <Label text="Financial Summary" style="-fx-font-weight: bold; -fx-font-size: 18px; -fx-text-fill: #7C4DFF;"/>
                                        <GridPane hgap="20" vgap="10">
                                            <Label text="Total Wallets:" GridPane.rowIndex="0" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="lblTotalWallets" text="0" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                                            <Label text="Total Transactions:" GridPane.rowIndex="1" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="lblTotalTransactions" text="0" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                                            <Label text="Total Amount:" GridPane.rowIndex="2" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                                            <Label fx:id="lblTotalAmount" text="0.00 DT" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                                            <Label text="Benefice:" GridPane.rowIndex="3" GridPane.columnIndex="0" style="-fx-font-weight: bold; -fx-text-fill: #10b981;"/>
                                            <Label fx:id="lblBenefice" text="0.00 DT" GridPane.rowIndex="3" GridPane.columnIndex="1" style="-fx-text-fill: #10b981;"/>
                                        </GridPane>
                                    </VBox>
                                </GridPane>
                            </VBox>
                        </Tab>
                    </TabPane>
                </VBox>
            </ScrollPane>
        </center>

        <!-- FOOTER -->
        <bottom>
            <HBox alignment="CENTER_RIGHT">
                <padding><Insets bottom="10" left="20" right="20" top="10"/></padding>
                <Label text="Â© 2026 SmartWallet Management System - Administration" style="-fx-text-fill: #94a3b8; -fx-font-size: 11px;"/>
            </HBox>
        </bottom>
    </BorderPane>

    <!-- Loading Overlay -->
    <VBox fx:id="loadingOverlay" styleClass="loading-overlay" visible="false" managed="false">
        <Label text="âŸ³" styleClass="loading-spinner"/>
        <Label text="Loading data..." style="-fx-text-fill: #7C4DFF; -fx-font-size: 14px;"/>
    </VBox>
</StackPane>